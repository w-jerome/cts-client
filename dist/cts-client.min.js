function CTSClient(t,e){return"string"==typeof t&&t?(this.key=t,this.timeout_delay="number"==typeof e&&e>0?e:1e4,this):this}CTSClient.prototype.getUtf8ToBase64=function(t){return window.btoa(unescape(encodeURIComponent(t)))},CTSClient.prototype.request=function(t,e,i){if(i="function"==typeof i?i:function(){},!this.key)return i(null,Error("API key missing")),this;if("string"!=typeof t||!t)return i(null,Error("Request missing")),this;if((e=Array.isArray(e)&&e.length?e:[]).length){for(var o=[],n=0;n<e.length;n++){var r=Object.keys(e[n])[0];if("string"==typeof r&&e[n][r]){var s=e[n][r];o.push(`${r}=${encodeURIComponent(s)}`)}}t=`${t}?${o.join("&")}`}var u=new XMLHttpRequest;u.open("GET",t,!0),u.overrideMimeType("application/json"),u.setRequestHeader("Authorization",`Basic ${this.getUtf8ToBase64(this.key)}`),u.timeout=this.timeout_delay,u.onload=function(){if(200!=this.status)return i(null,Error("API connexion fail")),this;try{var t=JSON.parse(this.response);i(t,null)}catch(t){i(null,Error(`JSON invalid: ${t.message}`))}},u.onerror=function(){i(null,Error("API error"))},u.send()},CTSClient.prototype.estimatedTimetable=function(t,e,i,o){t="function"==typeof t?t:function(){};var n=[];"string"==typeof e&&n.push({VehicleMode:e}),"string"==typeof i&&n.push({LineRef:i}),"number"==typeof o&&n.push({DirectionRef:o}),this.request("https://api.cts-strasbourg.eu/v1/siri/2.0/estimated-timetable",n,function(e,i){!i&&e&&(e=e.ServiceDelivery.EstimatedTimetableDelivery),t(e,i)})},CTSClient.prototype.linesDiscovery=function(t){t="function"==typeof t?t:function(){},this.request("https://api.cts-strasbourg.eu/v1/siri/2.0/lines-discovery",null,function(e,i){!i&&e&&(e=e.LinesDelivery.AnnotatedLineRef),t(e,i)})},CTSClient.prototype.stopMonitoring=function(t,e,i,o,n,r,s,u,p){if(t="function"==typeof t?t:function(){},"string"!=typeof e||!e)return t(null,Error("Settings missing")),this;var l=[{MonitoringRef:e}];"string"==typeof i&&l.push({VehicleMode:i}),"string"==typeof o&&l.push({PreviewInterval:o}),"string"==typeof n&&l.push({StartTime:n}),"string"==typeof r&&l.push({LineRef:r}),"number"==typeof s&&l.push({DirectionRef:s}),"number"==typeof u&&l.push({MaximumStopVisits:u}),"number"==typeof p&&l.push({MinimumStopVisitsPerLine:p}),this.request("https://api.cts-strasbourg.eu/v1/siri/2.0/stop-monitoring",l,function(e,i){if(!i&&e){var o=[];if(Array.isArray(e.ServiceDelivery.StopMonitoringDelivery))for(var n=0;n<e.ServiceDelivery.StopMonitoringDelivery.length;n++)if(Array.isArray(e.ServiceDelivery.StopMonitoringDelivery[n].MonitoredStopVisit))for(var r=0;r<e.ServiceDelivery.StopMonitoringDelivery[n].MonitoredStopVisit.length;r++)o.push(e.ServiceDelivery.StopMonitoringDelivery[n].MonitoredStopVisit[r].MonitoredVehicleJourney);e=o}t(e,i)})},CTSClient.prototype.stopPointsDiscovery=function(t,e,i,o){t="function"==typeof t?t:function(){};var n=[];"number"==typeof e&&n.push({latitude:e}),"number"==typeof i&&n.push({longitude:i}),"number"==typeof o&&n.push({distance:o}),this.request("https://api.cts-strasbourg.eu/v1/siri/2.0/stoppoints-discovery",n,function(e,i){!i&&e&&(e=e.StopPointsDelivery.AnnotatedStopPointRef),t(e,i)})},CTSClient.prototype.parkAndRide=function(t){this.request("https://api.cts-strasbourg.eu/v1/cts/park-and-ride",null,function(e,i){!i&&e&&(e=e.ParkAndRide),t(e,i)})},CTSClient.prototype.retailOutlet=function(t,e,i,o,n,r,s){t="function"==typeof t?t:function(){};var u=[];"boolean"==typeof e&&u.push({TicketSales:e}),"boolean"==typeof i&&u.push({BadgeoTopUp:i}),"string"==typeof o&&u.push({types:o}),"number"==typeof n&&u.push({latitude:n}),"number"==typeof r&&u.push({longitude:r}),"number"==typeof s&&u.push({distance:s}),this.request("https://api.cts-strasbourg.eu/v1/cts/retail-outlet",u,function(e,i){!i&&e&&(e=e.RetailOutlet),t(e,i)})},CTSClient.prototype.retailOutletTypes=function(t){this.request("https://api.cts-strasbourg.eu/v1/cts/retail-outlet/types",null,function(e,i){!i&&e&&(e=e.RetailOutletType),t(e,i)})},CTSClient.prototype.veloparc=function(t){this.request("https://api.cts-strasbourg.eu/v1/cts/veloparc",null,function(e,i){!i&&e&&(e=e.Veloparc),t(e,i)})},CTSClient.prototype.velhop=function(t){this.request("https://api.cts-strasbourg.eu/v1/velhop/velhop",null,function(e,i){!i&&e&&(e=e.Velhop),t(e,i)})};
