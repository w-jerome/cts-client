function CTSClient(t,e){return"string"==typeof t&&t?(this.key=t,this.timeout_delay="number"==typeof e&&e>0?e:1e4,this):this}CTSClient.prototype.getUtf8ToBase64=function(t){return window.btoa(unescape(encodeURIComponent(t)))},CTSClient.prototype.request=function(t,e,i){if(i="function"==typeof i?i:function(){},!this.key)return i(null,Error("API key missing")),this;if("string"!=typeof t||!t)return i(null,Error("Request missing")),this;if((e=Array.isArray(e)&&e.length?e:[]).length){for(var n=[],o=0;o<e.length;o++){var r=Object.keys(e[o])[0];if("string"==typeof r&&e[o][r]){var s=e[o][r];n.push(`${r}=${encodeURIComponent(s)}`)}}t=`${t}?${n.join("&")}`}var u=new XMLHttpRequest;u.open("GET",t,!0),u.overrideMimeType("application/json"),u.setRequestHeader("Authorization",`Basic ${this.getUtf8ToBase64(this.key)}`),u.timeout=this.timeout_delay,u.onload=function(){if(200!=this.status)return i(null,Error("API connexion fail")),this;try{var t=JSON.parse(this.response);i(t,null)}catch(t){i(null,Error(`JSON invalid: ${t.message}`))}},u.onerror=function(){i(null,Error("API error"))},u.send()},CTSClient.prototype.estimatedTimetable=function(t,e,i,n){t="function"==typeof t?t:function(){};var o=[];"string"==typeof e&&o.push({VehicleMode:e}),"string"==typeof i&&o.push({LineRef:i}),"number"==typeof n&&o.push({DirectionRef:n}),this.request("https://api.cts-strasbourg.eu/v1/siri/2.0/estimated-timetable",o,function(e,i){!i&&e&&(e=e.ServiceDelivery.EstimatedTimetableDelivery),t(e,i)})},CTSClient.prototype.linesDiscovery=function(t){t="function"==typeof t?t:function(){},this.request("https://api.cts-strasbourg.eu/v1/siri/2.0/lines-discovery",null,function(e,i){!i&&e&&(e=e.LinesDelivery.AnnotatedLineRef),t(e,i)})},CTSClient.prototype.stopMonitoring=function(t,e,i,n,o,r,s,u,p){if(t="function"==typeof t?t:function(){},"string"!=typeof e||!e)return t(null,Error("Settings missing")),this;var f=[{MonitoringRef:e}];"string"==typeof i&&f.push({VehicleMode:i}),"string"==typeof n&&f.push({PreviewInterval:n}),"string"==typeof o&&f.push({StartTime:o}),"string"==typeof r&&f.push({LineRef:r}),"number"==typeof s&&f.push({DirectionRef:s}),"number"==typeof u&&f.push({MaximumStopVisits:u}),"number"==typeof p&&f.push({MinimumStopVisitsPerLine:p}),this.request("https://api.cts-strasbourg.eu/v1/siri/2.0/stop-monitoring",f,function(e,i){if(!i&&e){var n=[];if(Array.isArray(e.ServiceDelivery.StopMonitoringDelivery))for(var o=0;o<e.ServiceDelivery.StopMonitoringDelivery.length;o++)if(Array.isArray(e.ServiceDelivery.StopMonitoringDelivery[o].MonitoredStopVisit))for(var r=0;r<e.ServiceDelivery.StopMonitoringDelivery[o].MonitoredStopVisit.length;r++)n.push(e.ServiceDelivery.StopMonitoringDelivery[o].MonitoredStopVisit[r].MonitoredVehicleJourney);e=n}t(e,i)})},CTSClient.prototype.stopPointsDiscovery=function(t,e,i,n){t="function"==typeof t?t:function(){};var o=[];"number"==typeof e&&o.push({latitude:e}),"number"==typeof i&&o.push({longitude:i}),"number"==typeof n&&o.push({distance:n}),this.request("https://api.cts-strasbourg.eu/v1/siri/2.0/stoppoints-discovery",o,function(e,i){!i&&e&&(e=e.StopPointsDelivery.AnnotatedStopPointRef),t(e,i)})};
